<!-- Declaración del tipo de documento HTML5 -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Registro - Tienda de Ropa</title>
  <link rel="stylesheet" href="../css/registro.css" />
</head>

<body>
  <!-- Encabezado -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="/" class="logo" aria-label="Tienda de Ropa">Tienda de Ropa</a>

      <!-- === Toggle de navegación para móvil (checkbox + label.hamburger) === -->
      <input id="navToggle" class="nav-toggle" type="checkbox" />
      <label for="navToggle" class="hamburger" aria-label="Abrir menú" aria-controls="siteNav">
        <span></span><span></span><span></span>
      </label>

      <!-- Menú -->
      <nav id="siteNav" class="nav">
        <a class="nav-link" href="/">Inicio</a>
        <a class="nav-link" href="/html/IniciarSesion.html">Iniciar Sesión</a>
      </nav>
    </div>
  </header>

  <!-- Contenido principal -->
  <main class="container main-wrap">
    <section class="registro-card" aria-labelledby="regTitle">
      <h2 id="regTitle">Registrarse</h2>
      <!-- Avisos accesibles -->
      <div id="registroFeedback" class="notice" role="status" aria-live="polite"></div>

      <!-- Mantengo tus names y tu endpoint -->
      <form id="registroForm" novalidate>
        <div class="input-group">
          <label for="nombre">Nombre completo</label>
          <div class="field">
            <input id="nombre" type="text" name="nombre" placeholder="Nombre y apellido" required />
            <span class="field-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Zm0 2c-4.4 0-8 2.2-8 5v1h16v-1c0-2.8-3.6-5-8-5Z"/></svg>
            </span>
          </div>
        </div>

        <div class="input-group">
          <label for="correo">Correo electrónico</label>
          <div class="field">
            <input id="correo" type="email" name="correo" inputmode="email" autocomplete="email"
                   placeholder="tucorreo@dominio.com" required />
            <span class="field-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm-1.4 4.25-6.23 4.67a1 1 0 0 1-1.2 0L4.94 8.25a.75.75 0 1 1 .92-1.2L12 11l6.14-3.95a.75.75 0 1 1 .86 1.2Z"/></svg>
            </span>
          </div>
        </div>

        <div class="input-group">
          <label for="pais">País</label>
          <div class="field">
            <select id="pais" name="pais" required autocomplete="country-name">
              <option value="Colombia" selected>Colombia</option>
            </select>
            <span class="field-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M4 6h16v12H4z"/></svg>
            </span>
          </div>
        </div>

        <div class="input-group">
          <label for="ciudad">Ciudad</label>
          <div class="field">
            <select id="ciudad" name="ciudad" required autocomplete="address-level2">
              <option value="Medellín" selected>Medellín</option>
            </select>
            <span class="field-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M12 2a7 7 0 0 0-7 7c0 5.25 7 13 7 13s7-7.75 7-13a7 7 0 0 0-7-7Zm0 9.5A2.5 2.5 0 1 1 14.5 9 2.5 2.5 0 0 1 12 11.5Z"/></svg>
            </span>
          </div>
        </div>

        <div class="input-group">
          <label for="celular">Celular</label>
          <div class="field">
            <input id="celular" type="number" name="celular" inputmode="tel"
                   placeholder="3001234567" required />
            <span class="field-icon" aria-hidden="true">
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M17 2H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2Zm-5 19a1.25 1.25 0 1 1 1.25-1.25A1.25 1.25 0 0 1 12 21Z"/></svg>
            </span>
          </div>
        </div>

        <div class="input-group">
          <label for="contrasena">Contraseña</label>
          <div class="field">
            <input id="contrasena" type="password" name="contraseña"
                   placeholder="Mínimo 8 caracteres" required minlength="8" />
            <!-- Ojo para mostrar/ocultar -->
            <button type="button" class="toggle-pass" aria-label="Mostrar contraseña" aria-pressed="false" title="Mostrar/Ocultar contraseña">
              <svg class="eye-open" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path fill="currentColor" d="M12 5C6.5 5 2.1 8.3 1 12c1.1 3.7 5.5 7 11 7s9.9-3.3 11-7c-1.1-3.7-5.5-7-11-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/>
              </svg>
              <svg class="eye-closed" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path fill="currentColor" d="M3 3 21 21l-1.5 1.5-2.3-2.3C15.6 21.1 13.9 22 12 22 6.5 22 2.1 18.7 1 15c.5-1.7 1.8-3.3 3.5-4.8L1.5 4.5 3 3Zm9-2c5.5 0 9.9 3.3 11 7-.4 1.3-1.1 2.6-2.2 3.8l-3.2-3.2A4.96 4.96 0 0 0 12 7c-.5 0-1 .1-1.5.2L8.7 5.4A10.7 10.7 0 0 1 12 1Z"/>
              </svg>
            </button>
          </div>
        </div>

        <button type="submit" id="btnRegistrar" class="btn btn-primary">Registrarse</button>
      </form>
    </section>
  </main>

  <!-- Pie de página -->
  <footer class="site-footer">
    <div class="container footer-inner">
      <p>&copy; 2025 Tienda de Ropa.</p>
    </div>
  </footer>

  <!-- Lógica: misma ruta y names; validación previa y ojito -->
  <script>
    const form = document.getElementById('registroForm');
    const feedback = document.getElementById('registroFeedback');
    const btn = document.getElementById('btnRegistrar');

    // Ojo mostrar/ocultar contraseña
    (function () {
      const btnToggle = document.querySelector('.toggle-pass');
      const input = document.getElementById('contrasena');
      if (!btnToggle || !input) return;

      const setMode = (show) => {
        input.type = show ? 'text' : 'password';
        btnToggle.setAttribute('aria-pressed', String(show));
        btnToggle.setAttribute('aria-label', show ? 'Ocultar contraseña' : 'Mostrar contraseña');
        btnToggle.classList.toggle('is-on', show);
      };
      btnToggle.addEventListener('click', () => {
        const show = btnToggle.getAttribute('aria-pressed') !== 'true';
        setMode(show);
      });
    })();

    form.addEventListener('input', () => { feedback.textContent = ''; });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      if (!form.checkValidity()) {
        feedback.textContent = 'Hay campos sin llenar';
        form.reportValidity();
        return;
      }
      const data = Object.fromEntries(new FormData(form));
      btn.disabled = true; btn.classList.add('is-loading');
      try {
        const res = await fetch('/api/auth/register', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        const resultado = await res.json();
        alert(resultado.mensaje || (res.ok ? 'Registro completado' : 'Hubo un problema al registrarte'));
        if (res.ok) window.location.href = '/html/IniciarSesion.html';
      } catch (err) {
        alert('No se pudo conectar con el servidor. Inténtalo de nuevo.');
      } finally {
        btn.disabled = false; btn.classList.remove('is-loading');
      }
    });
  </script>
  <script src="../js/main.js" defer></script>
</body>
</html>
