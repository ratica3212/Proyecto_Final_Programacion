<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Iniciar Sesión - Tienda de Ropa</title>
  <meta name="theme-color" content="#0e0f12"/>
  <link rel="stylesheet" href="../css/sesion.css"/>
</head>

<body>
  <!-- Header pegajoso (consistente con el home) -->
  <header class="site-header">
    <div class="container header-inner">
      <a href="/" class="logo" aria-label="Inicio">Tienda de Ropa</a>

      <input type="checkbox" id="nav-toggle" class="nav-toggle" aria-hidden="true"/>
      <label for="nav-toggle" class="hamburger" aria-label="Abrir menú" aria-controls="primary-nav" aria-expanded="false">
        <span></span><span></span><span></span>
      </label>

      <nav id="primary-nav" class="nav">
        <a href="/" class="nav-link">Inicio</a>
        <a href="/html/registro.html" id="link-register" class="btn btn-ghost">Registrarse</a>
      </nav>
    </div>
  </header>

  <main class="auth-wrap">
    <!-- Fondo decorativo -->
    <div class="bg-blobs" aria-hidden="true"></div>

    <!-- Tarjeta de login -->
    <section class="login-card container" aria-labelledby="loginTitle">
      <header class="card-head">
        <h1 id="loginTitle">Iniciar sesión</h1>
        <p class="sub">Entra para ver el catálogo y tus pedidos.</p>
      </header>

      <div id="login-feedback" class="notice" role="status" aria-live="polite"></div>

      <form id="loginForm" class="form" novalidate>
        <!-- Correo -->
        <div class="input-group">
          <label for="correo">Correo electrónico</label>
          <div class="field">
            <input
              id="correo"
              name="correo"
              type="email"
              inputmode="email"
              autocomplete="email"
              placeholder="tucorreo@dominio.com"
              required
            />
            <span class="field-icon" aria-hidden="true">
              <!-- ícono mail -->
              <svg viewBox="0 0 24 24" width="18" height="18"><path fill="currentColor" d="M20 4H4a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Zm-1.4 4.25-6.23 4.67a1 1 0 0 1-1.2 0L4.94 8.25a.75.75 0 1 1 .92-1.2L12 11l6.14-3.95a.75.75 0 1 1 .86 1.2Z"/></svg>
            </span>
          </div>
        </div>

        <!-- Contraseña con “ojito” -->
        <div class="input-group">
          <label for="contrasena">Contraseña</label>
          <div class="field">
            <input
              id="contrasena"
              name="contraseña"
              type="password"
              autocomplete="current-password"
              placeholder="********"
              required
            />
            <button
              type="button"
              class="toggle-pass"
              aria-label="Mostrar contraseña"
              aria-pressed="false"
              title="Mostrar/Ocultar contraseña"
            >
              <!-- ojo -->
              <svg class="eye-open" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path fill="currentColor" d="M12 5C6.5 5 2.1 8.3 1 12c1.1 3.7 5.5 7 11 7s9.9-3.3 11-7c-1.1-3.7-5.5-7-11-7Zm0 11a4 4 0 1 1 0-8 4 4 0 0 1 0 8Z"/>
              </svg>
              <svg class="eye-closed" viewBox="0 0 24 24" width="20" height="20" aria-hidden="true">
                <path fill="currentColor" d="M3 3 21 21l-1.5 1.5-2.3-2.3C15.6 21.1 13.9 22 12 22 6.5 22 2.1 18.7 1 15c.5-1.7 1.8-3.3 3.5-4.8L1.5 4.5 3 3Zm9-2c5.5 0 9.9 3.3 11 7-.4 1.3-1.1 2.6-2.2 3.8l-3.2-3.2A4.96 4.96 0 0 0 12 7c-.5 0-1 .1-1.5.2L8.7 5.4A10.7 10.7 0 0 1 12 1Z"/>
              </svg>
            </button>
          </div>
        </div>

        <button id="btnIngresar" type="submit" class="btn btn-primary btn-lg">Ingresar</button>
      </form>

      <footer class="card-foot">
        <p>¿Aún no tienes cuenta? <a class="link" href="/html/registro.html">Regístrate</a></p>
      </footer>
    </section>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <p>&copy; 2025 Tienda de Ropa.</p>
      <div class="socials" aria-label="Redes sociales">
        <a href="#" aria-label="Instagram" class="social">IG</a>
        <a href="#" aria-label="Facebook"  class="social">Fb</a>
        <a href="#" aria-label="TikTok"    class="social">Tk</a>
      </div>
    </div>
  </footer>

  <!-- Lógica del login + ojo contraseña -->
  <script>
    const form = document.getElementById('loginForm');
    const feedback = document.getElementById('login-feedback');
    const btn = document.getElementById('btnIngresar');

    // Toggle de contraseña
    (function () {
      const btnToggle = document.querySelector('.toggle-pass');
      const input = document.getElementById('contrasena');
      if (!btnToggle || !input) return;

      const setMode = (show) => {
        input.type = show ? 'text' : 'password';
        btnToggle.setAttribute('aria-pressed', String(show));
        btnToggle.setAttribute('aria-label', show ? 'Ocultar contraseña' : 'Mostrar contraseña');
        btnToggle.classList.toggle('is-on', show);
      };

      btnToggle.addEventListener('click', () => {
        const show = btnToggle.getAttribute('aria-pressed') !== 'true';
        setMode(show);
      });
    })();

    // Envío del formulario
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      feedback.textContent = '';
      btn.disabled = true;
      btn.classList.add('is-loading');

      // Solo los campos esperados por tu backend
      const correo = document.getElementById('correo').value.trim();
      const contrasena = document.getElementById('contrasena').value;

      try {
        const res = await fetch('/api/auth/IniciarSesion', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ correo, contraseña: contrasena })
        });

        const resultado = await res.json();

        // Mensaje agradable en la tarjeta
        feedback.textContent = resultado.mensaje || (res.ok ? 'Inicio de sesión correcto.' : 'Error al iniciar sesión.');

        if (res.ok && resultado.token) {
          localStorage.setItem('token', resultado.token);
          localStorage.setItem('usuario', JSON.stringify(resultado.usuario));
          window.location.href = '/html/catalogo.html';
        }
      } catch (err) {
        feedback.textContent = '';
      } finally {
        btn.disabled = false;
        btn.classList.remove('is-loading');
      }
    });
  </script>

  <script src="../js/main.js" defer></script>
</body>
</html>
